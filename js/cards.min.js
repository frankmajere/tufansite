(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};d=fc.util.Message,g=fc.algo.all,h=fc.algo.any,j=fc.algo.each,k=fc.algo.filter,m=fc.str.format,n=fc.klass,o=fc.algo.map,p=fc.algo.none,q=fc.algo.reduce,r=fc.algo.search,u=fc.arr.to_array,a="data/cards.json",t=function(){var a;return a={},function(b,c){var d;return d=a[b],null==d&&(d=$("#"+b).text().trim(),a[b]=d),m(d,c)}}(),f=function(){var a,b,c,d,e;return e=$("#tu"),d=$("#refine_card_list"),a=$("#card_list"),c=parseInt(e.css("padding-top")),b=parseInt(e.css("padding-bottom")),function(){var e,f,g;return g=$(window).height(),f=d.outerHeight(),e=g-c-b-f,a.outerHeight(e)}}(),l=function(){var a;return a={delay:function(a,b){var c;return c=a.delay(),v.call(b,c)>=0},faction:function(a,b){var c;return c=a.faction_id(),v.call(b,c)>=0},fusion:function(a,b){var c;return c=a.fusion(),v.call(b,c)>=0},max_attack:function(a,b){return a.attack()<=b},max_health:function(a,b){return a.health()<=b},min_attack:function(a,b){return b<=a.attack()},min_health:function(a,b){return b<=a.health()},name:function(a,b){return fc.str.like(a.name(),b,!1)},rarity:function(a,b){var c;return c=a.rarity_id(),v.call(b,c)>=0},skill:function(a,b){return g(b,function(b){return a.has_skill(b)})},type:function(a,b){var c;return c=a.type_id(),v.call(b,c)>=0}},function(b,c){return u(k(b,function(b){return g(c,function(c){var d,e;return d=c.key,e=c.value,a[d](b,e)})}))}}(),s=function(){var a,b,c;return b=fc.num.compare,c=fc.str.compare,a={attack:function(a,c){return b(a.attack(),c.attack())},delay:function(a,c){return b(a.delay(),c.delay())},faction:function(a,b){return c(a.faction_id(),b.faction_id())},fusion:function(a,c){return b(a.fusion(),c.fusion())},health:function(a,c){return b(a.health(),c.health())},name:function(a,b){return c(a.name(),b.name())},rarity:function(a,b){return c(a.rarity_id(),b.rarity_id())},type:function(a,b){return c(a.type_id(),b.type_id())}},function(b,c){var d,e;return e=a[c.item],d="asc"===c.order?function(a,b){return e(a,b)}:function(a,b){return e(b,a)},b.sort(d)}}(),i=function(){var a;return a=function(a){return q(a,"",function(a,b){return a+t("card_skill_template",{desc:b.desc(),id:b.id()})})},function(b){var c;return c=b.skills(),t("card_template",{art:b.art(),attack:b.attack(),delay:b.delay(),faction_id:b.faction_id(),fusion:b.fusion(),health:b.health(),id:b.id(),level:b.level(),max_level:b.max_level(),name:b.name(),rarity_id:b.rarity_id(),skills:a(b.skills()),type_id:b.type_id()})}}(),c=n({__init__:function(a,b){return this._tu=a,this._id=b.id,this._num=b.num,this._counter=b.counter,this._faction_id=b.faction_id,this._all=null!=b.all,this._ref_skill_id=b.ref_skill_id},all:function(){return this._all},desc:function(){var a;return a=this.name(),this._all&&(a+=" all"),null!=this._faction_id&&(a+=" "+this.faction()),null!=this._ref_skill_id&&(a+=" "+this.ref_skill()),null!=this._num&&(a+=" "+this._num),null!=this._counter&&(a+=" every "+this._counter),a},faction:function(){return null!=this._faction_id?this._tu.factions[this._faction_id].name:""},id:function(){return this._id},name:function(){return this._tu.skills[this._id].name},num:function(){var a;return null!=(a=this._num)?a:0},ref_skill:function(){return null!=this._ref_skill_id?this._tu.skills[this._ref_skill_id].name:""}}),b=n({__init__:function(a,b){return this._tu=a,this._data=b},art:function(){return this._stat("art","")},attack:function(){return this._stat("attack",-1)},delay:function(){return this._stat("delay",-1)},faction:function(){return this._tu.factions[this.faction_id()].name},faction_id:function(){return this._data.common.faction_id},fusion:function(){return this._data.common.fusion},has_skill:function(a){return h(this.skills(),function(b){return b.id()===a})},health:function(){return this._stat("health",-1)},id:function(){return this._data.id},level:function(){return this._data.level},levels:function(){return u(o(this._data.common.levels,function(a){return function(c){return b(a._tu,c)}}(this)))},max_level:function(){return this._data.common.levels.length-1},name:function(){return this._data.common.name},next_level:function(){return this._data.level===this.max_level()?null:this(this._data.common.levels[this._data.level+1])},prev_level:function(){return 0===this._data.level?null:this(this._data.common.levels[this._data.level-1])},rarity:function(){return this._tu.rarities[this.rarity_id()].name},rarity_id:function(){return this._data.common.rarity_id},set:function(){return this._tu.sets[this.set_id()].name},set_id:function(){return this._data.common.set_id},skills:function(){return q(this._stat("skills",[]),[],function(a){return function(b,d){var e;return e=function(a){return a.id()===d.id},p(b,e)&&b.push(c(a._tu,d)),b}}(this))},type:function(){return this._tu.types[this.type_id()].name},type_id:function(){return this._data.common.type_id},_stat:function(a,b){var c,d,e,f;for(null==b&&(b=null),c=e=f=this.level();0>=f?0>=e:e>=0;c=0>=f?++e:--e)if(d=this._data.common.levels[c][a],null!=d)return d;return b}}),(e=n({__init__:function(b){return $.ajax({dataType:"json",url:a,success:function(a){return function(c){return a._proc_data(c),b(a)}}(this)})},card:function(a){return b(this,this._cards[a])},cards:function(){return u(o(this._cards,function(a){return function(c){var d;return d=c.value,b(a,d)}}(this)))},_proc_cards_data:function(a){return q(a,{},function(a,b){var c,d;return c={levels:[],faction_id:b.faction_id,fusion:b.fusion,name:b.name,rarity_id:b.rarity_id,set_id:b.set_id,type_id:b.type_id},d=0,j(b.levels,function(b){var e;return e={common:c,id:b.id,level:d},null!=b.art&&(e.art=b.art),null!=b.attack&&(e.attack=b.attack),null!=b.delay&&(e.delay=b.delay),null!=b.health&&(e.health=b.health),null!=b.skills&&(e.skills=b.skills),c.levels[d]=a[b.id]=e,d+=1}),a})},_proc_data:function(a){return this._cards=this._proc_cards_data(a.cards),a.cards=null,this.delays=a.delays,this.factions=a.factions,this.fusions=a.fusions,this.rarities=a.rarities,this.sets=a.sets,this.skills=a.skills,this.types=a.types}}))(function(a){var b,c,e,g,h,j,m,p,v,w;return c=n(d,{__init__:function(a){return this.__apply__(d.prototype.__init__),this._cards=u(k(a,function(a){return a.level()===a.max_level()}))},filter:function(a){return this._refined=l(this._cards,a),this._update()},reset:function(){return this._refined=this._cards,this._update()},sort:function(a){return this._refined=s(this._refined,a),this._update()},_update:function(){return this.publish("update",this._refined)}}),e=n(d,{__init__:function(){return this.__apply__(d.prototype.__init__),this._jq=$("#card_list"),this._jq.on("click",".card",this.__method__("_on_click_card"))},update:function(a){var b;return b=q(a,"",function(a,b){return a+t("card_list_item_template",i(b))}),this._jq.html(b)},_on_click_card:function(a){var b,c;return c=$(a.target),b=c.closest(".card").data("id"),this.publish("click_card",b)}}),g=n(d,{__init__:function(a){return this.__apply__(d.prototype.__init__),this._filters={rarity:this._extract_ids(a.rarities),faction:this._extract_ids(a.factions),type:this._extract_ids(a.types),fusion:a.fusions,delay:a.delays,skill:this._extract_ids(a.skills)}},add_filter:function(a,b){return null==this._filter_spec[a]&&(this._filter_spec[a]=[]),this._filter_spec[a].push(b),this._filter_spec[a].length===this._filters[a].length&&delete this._filter_spec[a],this._change_filter()},change_filter:function(a,b){var c;return""===(c=b.toString())||"NaN"===c?delete this._filter_spec[a]:this._filter_spec[a]=b,this._change_filter()},change_sort:function(a,b){return this._sort_spec={item:a,order:b},this.publish("change_sort",this._sort_spec)},remove_filter:function(a,b){return null!=this._filter_spec[a]?(r(this._filter_spec[a],b).remove(),0===this._filter_spec[a].length&&delete this._filter_spec[a]):(this._filter_spec[a]=this._filters[a].slice(),r(this._filter_spec[a],b).remove()),this._change_filter()},reset:function(){return this._filter_spec={},this._sort_spec={},this.publish("reset")},_change_filter:function(){return this.publish("change_filter",this._filter_spec)},_extract_ids:function(a){return u(o(a,function(a){return a.key}))}}),h=n(d,{__init__:function(a){var b,c,e,f,g,h,i,j,k,l,m,n,o;for(this.__apply__(d.prototype.__init__),this._jq=$("#refine_card_list"),this._init_checker_filters(a),this._init_sorts(),this._jq.removeClass("uninitialized"),this._jq.on("click",".toggle",this.__method__("_on_click_toggle")),this._jq.on("click",".reset",this.__method__("_on_reset")),l=["name"],c=0,h=l.length;h>c;c++)b=l[c],this._jq.on("input",".filter[data-filter_item="+b+"]",function(a){return function(b){return a._on_change_value_filter(b)}}(this));for(m=["min_attack","max_attack","min_health","max_health"],e=0,i=m.length;i>e;e++)b=m[e],this._jq.on("input",".filter[data-filter_item="+b+"]",function(a){return function(b){return a._on_change_value_filter(b,parseInt)}}(this));for(n=["rarity","faction","skill","type"],f=0,j=n.length;j>f;f++)b=n[f],this._jq.on("click",".filter[data-filter_item="+b+"]",function(a){return function(b){return a._on_change_check_filter(b)}}(this));for(o=["delay","fusion"],g=0,k=o.length;k>g;g++)b=o[g],this._jq.on("click",".filter[data-filter_item="+b+"]",function(a){return function(b){return a._on_change_check_filter(b,parseInt)}}(this));return this._jq.on("click",".sort",this.__method__("_on_click_sort"))},_init_checker_filters:function(a){return this._init_rarity_filters(a.rarities),this._init_faction_filters(a.factions),this._init_type_filters(a.types),this._init_fusion_filters(a.fusions),this._init_delay_filters(a.delays),this._init_skill_filters(a.skills)},_init_delay_filters:function(a){var b,c;return c=["Instant","1 turn","2 turns","3 turns","4 turns","5 turns"],b=q(a,"",function(a,b){return a+t("refine_card_list_check_filter_template",{item:"delay",id:b,title:c[b]})}),$('[data-group="delay"]',this._jq).html(b)},_init_faction_filters:function(a){var b;return b=q(a,"",function(a,b){return a+t("refine_card_list_check_filter_template",{item:"faction",id:b.key,title:b.value.name})}),$('[data-group="faction"]',this._jq).html(b)},_init_fusion_filters:function(a){var b,c;return c=["Not fused","Fused","Double fused"],b=q(a,"",function(a,b){return a+t("refine_card_list_check_filter_template",{item:"fusion",id:b,title:c[b]})}),$('[data-group="fusion"]',this._jq).html(b)},_init_rarity_filters:function(a){var b;return b=q(a,"",function(a,b){return a+t("refine_card_list_check_filter_template",{item:"rarity",id:b.key,title:b.value.name})}),$('[data-group="rarity"]',this._jq).html(b)},_init_skill_filters:function(a){var b;return b=q(a,"",function(a,b){return a+t("refine_card_list_check_filter_template",{item:"skill",id:b.key,title:b.value.name})}),$('[data-group="skill"]',this._jq).append(b)},_init_sorts:function(){var a,b;return b=["name","rarity","faction","type","fusion","delay","attack","health"],a=q(b,"",function(a,b){return a+t("refine_card_list_sort_template",{item:b,title:fc.str.title(b)})}),$('[data-group="sort"]',this._jq).html(a)},_init_type_filters:function(a){var b;return b=q(a,"",function(a,b){return a+t("refine_card_list_check_filter_template",{item:"type",id:b.key,title:b.value.name})}),$('[data-group="type"]',this._jq).html(b)},_on_change_check_filter:function(a,b){var c,d,e;return null==b&&(b=function(a){return a}),e=$(a.target),e.toggleClass("checked"),d=e.attr("data-filter_item"),c=b(e.attr("data-id")),e.is(".checked")?this.publish("add_filter",d,c):this.publish("remove_filter",d,c)},_on_change_value_filter:function(a,b){var c,d,e;return null==b&&(b=function(a){return a}),e=$(a.target),d=e.attr("data-filter_item"),c=b(e.val()),this.publish("change_filter",d,c)},_on_click_sort:function(a){var b,c,d;return c=$(a.target),b=c.attr("data-sort_item"),d=c.attr("data-order"),$(".sort",this._jq).removeAttr("data-order"),"asc"===d?(c.attr("data-order","desc"),this.publish("change_sort",b,"desc")):(c.attr("data-order","asc"),this.publish("change_sort",b,"asc"))},_on_reset:function(){var a,b,c,d;for($(":input",this._jq).val(""),d=["rarity","faction","type","fusion","delay","skill"],b=0,c=d.length;c>b;b++)a=d[b],$("[data-filter_item="+a+"]",this._jq).removeClass("checked");return $(".sort",this._jq).removeClass("asc desc"),this.publish("reset")},_on_click_toggle:function(){return this._jq.toggleClass("full"),this.publish("toggle")}}),b=n(d,{__init__:function(a){return this.__apply__(d.prototype.__init__),this._tu=a,this._jq=$("#card_detail"),this._jq.on("click",this.__method__("_on_click"))},update:function(a){var b,c;return b=this._tu.card(a),c=q(b.levels(),"",function(a,b){return a+("<li>"+i(b)+"</li>")}),$(".card_levels",this._jq).html(c),this._jq.addClass("active")},_on_click:function(a){return a.target===this._jq[0]?this._jq.removeClass("active"):void 0}}),m=c(a.cards()),p=e(),v=g(a),w=h(a),j=b(a),m.subscribe("update",function(a,b){return p.update(b)}),p.subscribe("click_card",function(a,b){return j.update(b)}),v.subscribe("reset",function(){return m.reset()}),v.subscribe("change_sort",function(a,b){return m.sort(b)}),v.subscribe("change_filter",function(a,b){return m.filter(b)}),w.subscribe("reset",function(){return v.reset()}),w.subscribe("add_filter",function(a,b,c){return v.add_filter(b,c)}),w.subscribe("remove_filter",function(a,b,c){return v.remove_filter(b,c)}),w.subscribe("change_filter",function(a,b,c){return v.change_filter(b,c)}),w.subscribe("change_sort",function(a,b,c){return v.change_sort(b,c)}),w.subscribe("toggle",f),$(window).resize(f),f(),v.reset()})}).call(this);